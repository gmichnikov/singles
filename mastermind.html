<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mastermind</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        background: linear-gradient(to bottom right, #1e293b, #0f172a);
        padding: 2rem;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
      }

      .container {
        max-width: 56rem;
        margin: 0 auto;
      }

      h1 {
        font-size: 2.25rem;
        font-weight: bold;
        color: white;
        text-align: center;
        margin-bottom: 0.5rem;
      }

      .subtitle {
        color: #d1d5db;
        text-align: center;
        margin-bottom: 1.5rem;
      }

      .possibilities-counter {
        background-color: #2563eb;
        color: white;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1.5rem;
        text-align: center;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      }

      .possibilities-counter .label {
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.25rem;
      }

      .possibilities-counter .count {
        font-size: 3rem;
        font-weight: bold;
      }

      .possibilities-counter .total {
        font-size: 0.875rem;
        margin-top: 0.25rem;
      }

      .section {
        background-color: #374151;
        border-radius: 0.5rem;
        padding: 1rem;
        margin-bottom: 1.5rem;
      }

      .section-title {
        color: white;
        text-align: center;
        margin-bottom: 0.75rem;
        font-weight: 600;
      }

      .secret-code {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
      }

      .game-status {
        text-align: center;
        font-size: 1.5rem;
        font-weight: bold;
        margin-bottom: 1.5rem;
      }

      .game-status.won {
        color: #4ade80;
      }

      .game-status.lost {
        color: #f87171;
      }

      .guess-builder {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .color-circle {
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        border: 2px solid #374151;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      .color-circle.small {
        width: 2.5rem;
        height: 2.5rem;
      }

      .empty-slot {
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        border: 2px dashed #6b7280;
        background-color: #4b5563;
      }

      .buttons {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      button {
        padding: 0.5rem 1rem;
        border: none;
        border-radius: 0.25rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
      }

      button:disabled {
        background-color: #4b5563 !important;
        cursor: not-allowed;
        opacity: 0.5;
      }

      .btn-undo {
        background-color: #dc2626;
        color: white;
      }

      .btn-undo:hover:not(:disabled) {
        background-color: #b91c1c;
      }

      .btn-submit {
        background-color: #16a34a;
        color: white;
        padding: 0.5rem 1.5rem;
      }

      .btn-submit:hover:not(:disabled) {
        background-color: #15803d;
      }

      .btn-new-game {
        background-color: #9333ea;
        color: white;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
      }

      .btn-new-game:hover {
        background-color: #7e22ce;
      }

      .color-palette {
        display: flex;
        justify-content: center;
        gap: 0.75rem;
        flex-wrap: wrap;
      }

      .color-button {
        transform: scale(1);
        transition: transform 0.2s;
        cursor: pointer;
        padding: 0;
        background: none;
        border: none;
      }

      .color-button:hover:not(:disabled) {
        transform: scale(1.1);
      }

      .color-button:disabled {
        opacity: 0.5;
      }

      .guesses-list {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }

      .guess-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        background-color: #1f2937;
        padding: 0.75rem;
        border-radius: 0.25rem;
      }

      .guess-number {
        color: #9ca3af;
        width: 2rem;
      }

      .guess-colors {
        display: flex;
        gap: 0.5rem;
      }

      .feedback {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .pegs {
        display: flex;
        gap: 0.25rem;
        flex-wrap: wrap;
        width: 4rem;
      }

      .peg {
        width: 0.75rem;
        height: 0.75rem;
        border-radius: 50%;
        border: 1px solid #9ca3af;
      }

      .peg.black {
        background-color: black;
      }

      .peg.white {
        background-color: white;
      }

      .feedback-text {
        color: #d1d5db;
        font-size: 0.875rem;
        width: 5rem;
        text-align: right;
      }

      .empty-state {
        color: #9ca3af;
        text-align: center;
        font-size: 0.875rem;
      }

      .instructions {
        margin-top: 2rem;
      }

      .instructions ul {
        list-style: none;
        color: #d1d5db;
        font-size: 0.875rem;
      }

      .instructions li {
        margin-bottom: 0.25rem;
      }

      .center {
        text-align: center;
        margin-top: 1.5rem;
      }

      .small-label {
        color: white;
        text-align: center;
        margin-bottom: 0.75rem;
        font-size: 0.875rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Mastermind</h1>
      <p class="subtitle">Crack the 4-color code!</p>

      <!-- Remaining Possibilities Counter -->
      <div class="possibilities-counter">
        <div class="label">Remaining Possibilities</div>
        <div class="count" id="possibilitiesCount">1296</div>
        <div class="total">out of 1,296 codes</div>
      </div>

      <!-- Secret Code (shown when game is over) -->
      <div id="secretCodeSection" class="section" style="display: none">
        <div class="section-title">Secret Code:</div>
        <div class="secret-code" id="secretCode"></div>
      </div>

      <!-- Game Status -->
      <div id="gameStatus" class="game-status" style="display: none"></div>

      <!-- Current Guess Builder -->
      <div id="guessBuilderSection" class="section">
        <div class="section-title" id="guessTitle">Your Guess (1/10)</div>
        <div class="guess-builder" id="guessBuilder"></div>
        <div class="buttons">
          <button class="btn-undo" id="undoBtn" onclick="removeLastColor()">
            Undo
          </button>
          <button class="btn-submit" id="submitBtn" onclick="submitGuess()">
            Submit Guess
          </button>
        </div>
      </div>

      <!-- Color Palette -->
      <div id="colorPaletteSection" class="section">
        <div class="small-label">Select Colors:</div>
        <div class="color-palette" id="colorPalette"></div>
      </div>

      <!-- Previous Guesses -->
      <div class="section">
        <div class="section-title">Previous Guesses</div>
        <div id="guessesList" class="guesses-list">
          <div class="empty-state">No guesses yet</div>
        </div>
      </div>

      <!-- New Game Button -->
      <div class="center">
        <button class="btn-new-game" onclick="startNewGame()">New Game</button>
      </div>

      <!-- Instructions -->
      <div class="section instructions">
        <div class="section-title">How to Play:</div>
        <ul>
          <li>• Guess the secret 4-color code in 10 tries or less</li>
          <li>• Black pegs (B): Correct color in correct position</li>
          <li>• White pegs (W): Correct color in wrong position</li>
          <li>
            • The counter shows how many codes are still possible based on your
            guesses
          </li>
        </ul>
      </div>
    </div>

    <script>
      const COLORS = ["red", "blue", "green", "yellow", "orange", "purple"];
      const CODE_LENGTH = 4;
      const MAX_GUESSES = 10;

      let secret = [];
      let currentGuess = [];
      let guesses = [];
      let gameOver = false;
      let possibleCodes = [];

      // Generate all 1296 possible codes
      function generateAllCodes() {
        const codes = [];
        for (let i = 0; i < COLORS.length; i++) {
          for (let j = 0; j < COLORS.length; j++) {
            for (let k = 0; k < COLORS.length; k++) {
              for (let l = 0; l < COLORS.length; l++) {
                codes.push([COLORS[i], COLORS[j], COLORS[k], COLORS[l]]);
              }
            }
          }
        }
        return codes;
      }

      // Calculate feedback for a guess
      function getFeedback(secret, guess) {
        const secretCopy = [...secret];
        const guessCopy = [...guess];
        let black = 0;
        let white = 0;

        // Count black pegs (exact matches)
        for (let i = 0; i < CODE_LENGTH; i++) {
          if (guessCopy[i] === secretCopy[i]) {
            black++;
            secretCopy[i] = null;
            guessCopy[i] = null;
          }
        }

        // Count white pegs (color matches in wrong position)
        for (let i = 0; i < CODE_LENGTH; i++) {
          if (guessCopy[i] !== null) {
            const index = secretCopy.indexOf(guessCopy[i]);
            if (index !== -1) {
              white++;
              secretCopy[index] = null;
            }
          }
        }

        return { black, white };
      }

      // Check if two feedback objects are equal
      function feedbackEquals(f1, f2) {
        return f1.black === f2.black && f1.white === f2.white;
      }

      // Update possible codes based on guesses
      function updatePossibleCodes() {
        if (guesses.length === 0) {
          possibleCodes = generateAllCodes();
        } else {
          let remaining = generateAllCodes();

          for (const entry of guesses) {
            remaining = remaining.filter((code) => {
              const testFeedback = getFeedback(code, entry.guess);
              return feedbackEquals(testFeedback, entry.feedback);
            });
          }

          possibleCodes = remaining;
        }

        document.getElementById("possibilitiesCount").textContent =
          possibleCodes.length;
      }

      // Create a color circle element
      function createColorCircle(color, size = "") {
        const circle = document.createElement("div");
        circle.className = `color-circle ${size}`;
        circle.style.backgroundColor = color;
        return circle;
      }

      // Render the guess builder
      function renderGuessBuilder() {
        const builder = document.getElementById("guessBuilder");
        builder.innerHTML = "";

        for (let i = 0; i < CODE_LENGTH; i++) {
          if (currentGuess[i]) {
            builder.appendChild(createColorCircle(currentGuess[i]));
          } else {
            const emptySlot = document.createElement("div");
            emptySlot.className = "empty-slot";
            builder.appendChild(emptySlot);
          }
        }

        // Update buttons
        document.getElementById("undoBtn").disabled = currentGuess.length === 0;
        document.getElementById("submitBtn").disabled =
          currentGuess.length !== CODE_LENGTH;
      }

      // Render color palette
      function renderColorPalette() {
        const palette = document.getElementById("colorPalette");
        palette.innerHTML = "";

        COLORS.forEach((color) => {
          const button = document.createElement("button");
          button.className = "color-button";
          button.disabled = currentGuess.length >= CODE_LENGTH || gameOver;
          button.onclick = () => addColorToGuess(color);
          button.appendChild(createColorCircle(color));
          palette.appendChild(button);
        });
      }

      // Render guesses list
      function renderGuessesList() {
        const list = document.getElementById("guessesList");

        if (guesses.length === 0) {
          list.innerHTML = '<div class="empty-state">No guesses yet</div>';
          return;
        }

        list.innerHTML = "";
        guesses.forEach((entry, i) => {
          const row = document.createElement("div");
          row.className = "guess-row";

          // Guess number
          const number = document.createElement("div");
          number.className = "guess-number";
          number.textContent = `#${i + 1}`;
          row.appendChild(number);

          // Colors
          const colors = document.createElement("div");
          colors.className = "guess-colors";
          entry.guess.forEach((color) => {
            colors.appendChild(createColorCircle(color, "small"));
          });
          row.appendChild(colors);

          // Feedback
          const feedback = document.createElement("div");
          feedback.className = "feedback";

          const pegs = document.createElement("div");
          pegs.className = "pegs";

          for (let j = 0; j < entry.feedback.black; j++) {
            const peg = document.createElement("div");
            peg.className = "peg black";
            pegs.appendChild(peg);
          }

          for (let j = 0; j < entry.feedback.white; j++) {
            const peg = document.createElement("div");
            peg.className = "peg white";
            pegs.appendChild(peg);
          }

          feedback.appendChild(pegs);

          const text = document.createElement("div");
          text.className = "feedback-text";
          text.textContent = `${entry.feedback.black}B ${entry.feedback.white}W`;
          feedback.appendChild(text);

          row.appendChild(feedback);
          list.appendChild(row);
        });
      }

      // Add color to current guess
      function addColorToGuess(color) {
        if (currentGuess.length < CODE_LENGTH && !gameOver) {
          currentGuess.push(color);
          renderGuessBuilder();
          renderColorPalette();
        }
      }

      // Remove last color from guess
      function removeLastColor() {
        if (currentGuess.length > 0 && !gameOver) {
          currentGuess.pop();
          renderGuessBuilder();
          renderColorPalette();
        }
      }

      // Submit current guess
      function submitGuess() {
        if (currentGuess.length !== CODE_LENGTH || gameOver) return;

        const feedback = getFeedback(secret, currentGuess);
        guesses.push({ guess: [...currentGuess], feedback });
        currentGuess = [];

        updatePossibleCodes();
        renderGuessBuilder();
        renderGuessesList();
        renderColorPalette();

        document.getElementById("guessTitle").textContent = `Your Guess (${
          guesses.length + 1
        }/${MAX_GUESSES})`;

        if (feedback.black === CODE_LENGTH) {
          endGame(true);
        } else if (guesses.length >= MAX_GUESSES) {
          endGame(false);
        }
      }

      // End the game
      function endGame(won) {
        gameOver = true;

        // Show secret code
        const secretSection = document.getElementById("secretCodeSection");
        secretSection.style.display = "block";
        const secretCodeDiv = document.getElementById("secretCode");
        secretCodeDiv.innerHTML = "";
        secret.forEach((color) => {
          secretCodeDiv.appendChild(createColorCircle(color));
        });

        // Show game status
        const statusDiv = document.getElementById("gameStatus");
        statusDiv.style.display = "block";
        statusDiv.className = `game-status ${won ? "won" : "lost"}`;
        statusDiv.textContent = won ? "🎉 You Won!" : "😞 Game Over";

        // Hide guess builder and color palette
        document.getElementById("guessBuilderSection").style.display = "none";
        document.getElementById("colorPaletteSection").style.display = "none";
      }

      // Start a new game
      function startNewGame() {
        const allCodes = generateAllCodes();
        secret = allCodes[Math.floor(Math.random() * allCodes.length)];
        currentGuess = [];
        guesses = [];
        gameOver = false;
        possibleCodes = allCodes;

        // Reset UI
        document.getElementById("secretCodeSection").style.display = "none";
        document.getElementById("gameStatus").style.display = "none";
        document.getElementById("guessBuilderSection").style.display = "block";
        document.getElementById("colorPaletteSection").style.display = "block";
        document.getElementById("guessTitle").textContent = "Your Guess (1/10)";

        updatePossibleCodes();
        renderGuessBuilder();
        renderColorPalette();
        renderGuessesList();
      }

      // Initialize game on page load
      window.onload = function () {
        startNewGame();
      };
    </script>
  </body>
</html>
